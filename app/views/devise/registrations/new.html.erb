<% content_for :customer_title do %>
  注册
<% end %>
<style type="text/css">
  select {
    margin:  7px auto;
  }
  .mask {
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    width: 200px;
    height: 150px;
    margin-top: -75px;
    margin-left: -100px;
    background-color: yellow;
  }
  body {
    margin-top: -25px;
  }
</style>
<div class="form-box">
  <%= form_for(resource, as: resource_name, url: registration_path(resource_name), class: 'input-group') do |f| %>
    <%= devise_error_messages! %>
    <div class="input-row">
      <%= f.label :username %>
      <%= f.text_field :username, autofocus: true %>
    </div>
    <div class="input-row">
      <%= f.label :email %>
      <%= f.email_field :email %>
    </div>
    <div class="">
      <% if @validatable %>
      <em>(最少<%= @minimum_password_length %>个字符)</em>
      <% end %>
    </div>
    <div class="input-row">
      <%= f.label :password %>
      <%= f.password_field :password, autocomplete: "off" %>
    </div>
    <div class="input-row">
      <%= f.label :password_confirmation %>
      <%= f.password_field :password_confirmation, autocomplete: "off" %>
    </div>
    <input type="hidden" name="invite_code" value=""  class="invite_code" />
    <input type="hidden" name="province" value="" class="province" />
    <input type="hidden" name="city" value="" class="city" />
    <input type="hidden" name="region" value="" class="region" />
    <%= f.submit '注册', class: 'btn btn-red btn-block' %>
  <% end %>
</div>

  <div class="mask">
    <div class="input-row">
      <label>省份</label>
      <select name="province" id="s1" ></select>
    </div>
    <div class="input-row">
      <label>城市</label>
      <select name="city" id="s2"></select>
    </div>
    <div class="input-row">
      <label>地区</label>
      <select name="region" id="s3"></select>
    </div>
  </div>


<nav class="bar bar-tab">
  <a class="tab-item" href="#">
    <span class="icon icon-background-base icon-home"></span>
    <span class="tab-label">主页</span>
  </a>
  <a class="tab-item active" href="#">
    <span class="icon icon-background-base icon-person-hover"></span>
    <span class="tab-label">用户中心</span>
  </a>
  <a class="tab-item" href="#">
    <span class="icon icon-background-base icon-cart"></span>
    <span class="tab-label">购物</span>
  </a>
  <a class="tab-item" href="#">
    <span class="icon icon-background-base icon-search"></span>
    <span class="tab-label">搜索</span>
  </a>
  <a class="tab-item" href="#">
    <span class="icon icon-background-base icon-cat"></span>
    <span class="tab-label">分类</span>
  </a>
</nav>
<script src="/backend/assets/js/administrative-division.js" type="text/javascript"></script>
<script src="/backend/assets/js/multilevel-select.js" type="text/javascript"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=1.4"></script>
<script>
(function () {
  $(document).on('ready page:load', function () {

    MultilevelSelect({
      data: ADMINISTRATIVE_DIVISION,
      nodes: [$('#s1'), $('#s2'), $('#s3')]
    });

  });
  $(document).on('ready page:load', function () {
    function getLocationDemoA()
    {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPositionDemoA);
      } else {
        location.html("你的浏览器不支持地理位置定位.");
      }
    }
    function showPositionDemoA(position) {
      var location = $('.location');
      var lat = position.coords.latitude;
      var lon = position.coords.longitude;
      var point = new BMap.Point(lon,lat);
      var geoc = new BMap.Geocoder();
      geoc.getLocation(point, function(rs){
        var addComp = rs.addressComponents;
        var confirms = confirm("你现在位于："+addComp.province+addComp.city+addComp.district+"！要修改地址吗？");
        if (confirms) {
          $('.form-box').hide();
          $('.mask').slideDown(200);
        }else{
          $('.province').val(addComp.province);
          $('.city').val(addComp.city);
          $('.region').val(addComp.district);
        }
      });
    }
    getLocationDemoA();
  });
  $(document).on('ready page:load',function(){
    var url  =  $.url();
    var invite_code  =  url.param("invite_code");
    if(invite_code){
      $(".invite_code").val(invite_code[0]);
    }
    else{
      return false;
    }
  });

}).call(this);

</script>
